<div class="row m-0 bg-white">
  <div class="col-12 p-0">
    <div class="nav-parent">
      <div class="d-flex justify-content-between">
        <!-- MAIN LOGO -->
        <div class="my-auto d-flex d-none d-md-block pointer"  [routerLink]="'/home/member'">
          <img class="me-2" src="https://dev1mg.blob.core.windows.net/mgate/logo/Logo.png" alt="logo" class="logo-svg" >
        </div>

        <!-- LARGE SCREEN NAVIGATION OPTION -->
        <nav class="navbar navbar-expand-sm p-0 d-none d-sm-none d-md-block">
        <div class="container-fluid">
          <ul class="navbar-nav d-flex flex-row gap-3">
            <li class="nav-item">
              <a class="nav-link"
                [routerLink]="['/home/member']"
                [class.active-link]="router.isActive('/home', { paths: 'subset', queryParams: 'ignored', matrixParams: 'ignored', fragment: 'ignored' })">
                <i class="fas fa-home fa-lg me-1 text-muted"></i> Home
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link"
                [routerLink]="['/member/profiles']"
                [class.active-link]="router.isActive('/member', { paths: 'subset', queryParams: 'ignored', matrixParams: 'ignored', fragment: 'ignored' })">
                <i class="fas fa-users me-1 text-muted"></i> Members
              </a>
            </li>
          </ul>
        </div>
        </nav>

         <!-- MOBILE SCREEN NAVIGATION OPTION -->
        <nav class="bottom-nav navbar fixed-bottom bg-white border-top shadow-sm py-2 d-block d-dm-block d-md-none">
          <div class="container d-flex justify-content-around text-center mb-2">
            <a class="nav-item nav-link p-2"   [routerLink]="['/home/member']"
                [class.active-m-link]="router.isActive('/home/member', { paths: 'subset', queryParams: 'ignored', matrixParams: 'ignored', fragment: 'ignored' })">
              <i class="fas fa-home fa-md d-block"></i>
              <!-- <small>Home</small> -->
            </a>

            <a class="nav-item nav-link p-2" [routerLink]="['/member/profiles']"
                [class.active-m-link]="router.isActive('/member', { paths: 'subset', queryParams: 'ignored', matrixParams: 'ignored', fragment: 'ignored' })">
              <i class="fas fa-users fa-md d-block"></i>
            </a>

            <a class="nav-item nav-link p-2"[routerLink]="['home/chat']" [class.active-m-link]="router.isActive('/home/chat', { paths: 'subset', queryParams: 'ignored', matrixParams: 'ignored', fragment: 'ignored' })"  >
              <i class="fas fa-comments fa-md d-block" ></i>
            </a>

            <a class="nav-item nav-link p-2" [routerLink]="['home/main-user']" [class.active-m-link]="router.isActive('/home/main-user', { paths: 'subset', queryParams: 'ignored', matrixParams: 'ignored', fragment: 'ignored' })" *ngIf="mainUser">
              <img  src="{{mainUser.image}}" class="m-list-profile object-fit-cover" alt="..." width="33px" height="33px">
            </a>
          </div>
        </nav>

        <!-- LEFT SIDE NOTIFICATION CHAT AND PROFILE -->
        <div class="me-2 position-relative d-none d-md-block">
          <div class="d-flex">
            <div class="mt-2 me-3 member" *ngIf="!isLoading && selectedMember">
              <div class="d-flex">
                <img class="object-fit-cover me-2" src={{selectedMember.profileImages[0].url}} alt="profile" width="40px" height="40px">
                <div class="my-auto fw-bold text-sm">{{selectedMember.firstName}}</div>
              </div>
            </div>
            <!-- MESSAGE -->
            <div class="circles border me-2 pointer position-relative mes " (click)="toggleDropdown('message')" *ngIf="memberProfiles.length > 0" >
              <i class="fas fa-comments fa-md"></i>
              <div class="text-white bg-danger notification-bandage position-absolute p-2">{{UnreadCount}}</div>
            </div>
            <!-- NOTIFICATION -->
            <div class="circles border me-2 pointer position-relative noti " (click)="toggleDropdown('notification')" *ngIf="memberProfiles.length > 0">
              <i class="fas fa-bell fa-lg"></i>
              <div class="text-white bg-danger notification-bandage position-absolute p-2">5</div>
            </div>
           <div class="profile-image pointer profi position-relative" (click)="toggleDropdown('profile')" *ngIf="mainUser">
              <img class="circles object-fit-cover" [src]="mainUser.image" alt="Profile Image" />
              <div class="dropdown-icon">
                <i class="fas fa-caret-down"></i> <!-- or use a custom SVG -->
              </div>
            </div>
          </div>

          <!-- NOTIFICATION DROP DOWNBOX -->
          <div class="boder rounded bg-white position-absolute message-box" *ngIf="isNotificationOpen">
            <div class="fw-bold text-sm">Notifications</div>
          </div>
          <!-- NOTIFICATION DROP DOWNBOX END -->

          <!-- CHAT DROP DOWN -->
          <div class="boder rounded bg-white position-absolute message-box fw-bold" *ngIf="isMessageOpen">
            <h5><i class="fas fa-comments text-md me-2"></i>Messages</h5>
            <div class="message-wrapper mt-0" *ngIf="participants.length > 0">
              <div class="search-wrapper">
                <input type="text" class="search-field" placeholder="Search conversations..." [(ngModel)]="searchTerm">
              </div>
              <div class="conversation-list">
                <div class="conversation-item" [class.selected]="selectedChatId === participant.receiverProfileId" *ngFor="let participant of participants"
                  (click)="openChat(participant)">
                  <div class="d-flex align-items-center" [routerLink]="['home/chat']" >
                    <div class="avatar-wrapper">
                      <img *ngIf="participant.profileImage" [src]="participant.profileImage" [alt]="participant.name" class="avatar-image" onerror="this.style.display='none'">
                      <div *ngIf="!participant.profileImage" class="avatar-initials"> {{ getInitials(participant.name) }} </div>
                      <!-- <div *ngIf="participant.isRead" class="status-online"></div> -->
                    </div>

                    <div class="conversation-details">
                      <div class="user-name">{{ participant.name }}</div>
                      <div class="recent-message" > {{participant.isSentByMe ? 'You: ' : ''}} {{ participant.lastMessage }} </div>
                    </div>
                    <div class="conversation-meta">
                      <div class="message-time">{{ participant.lastSentAt }}</div>
                      <!-- <div *ngIf="par.unReadCount > 0" class="notification-badge"> {{ chat.unReadCount }}</div> -->
                       <div class="notification-badge" *ngIf="participant.isRead"> <i  class="fas fa-circle text-danger"></i></div>
                    </div>
                  </div>
                </div>

              </div>
            </div>
            <div *ngIf="participants.length === 0">
              <div class="text-md text-center mb-3">
                <div>
                   <svg width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" class="text-muted">
                    <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                    <path d="M8 9h8"></path>
                    <path d="M8 13h6"></path>
                  </svg>
                </div>
                No conversations yet
              </div>
            </div>
          </div>
          <!-- END CHAT DROP DOWN -->

          <!-- PROFILE DROPDOWNBOX -->
          <div class="boder rounded bg-white position-absolute" [ngClass]="memberProfiles.length === 0 ? 'register-drop' : 'message-box'" *ngIf="isProfileOpen">
            <div class="d-flex pointer" [routerLink]="['home/main-user']" *ngIf="mainUser">
              <div class="me-3"> <img  src={{mainUser.image}} class="list-profile object-fit-cover" alt="..."> </div>
              <div class="my-auto fw-bold"> {{mainUser.firstName +' '+ (mainUser.lastName === null ? '' : mainUser.lastName)}}</div>
            </div>
            <hr>
            <div class="text-sm" *ngIf="memberProfiles.length > 0">
              <div class="text-md fw-bold my-auto ps-2 pb-2">Members</div>
              <div class="member-toggle-list pointer mt-2"  *ngFor="let p of displayedProfiles">
                <div class="d-flex p-2 member-card border-radios-15" (click)="changeMemberProfile(p.id)"  [ngClass]="{'active-user' : p.id == selectedMember.id }">
                  <div class="me-3"> <img [src]="p.profileImages[0].url" class="list-profile object-fit-cover" alt="..."></div>
                  <div class="my-auto fw-normal"> {{p.firstName +' ' + p.lastName}}</div>
                </div>
              </div>
              <div class="d-flex p-2 member-card border-radios-15 pointer" (click)="navigateToRegister()" *ngIf="canAddProfile">
                <div class="small-circle border me-2 pointer position-relative mes" *ngIf="memberProfiles.length > 0" >
                  <i class="fas fa-user-plus fa-lg"></i>
                </div>
                <div class="my-auto">
                    create new member profile
                </div>
              </div>
              <div class="my-2 pointer">
                <button class="btn w-100 my-auto" [ngClass]="canAddProfile ? 'btn-secondary' : ' btn-danger'" (click)="canAddProfile = !canAddProfile">{{canAddProfile ? 'cancel' :'See all members' }}</button>
              </div>
              <div class="text-md fw-bold ps-2 pb-2" >Settings</div>
            </div>

             <div class="d-flex p-2 member-card border-radios-15 pointer mb-3" (click)="navigateToRegister()" *ngIf="memberProfiles.length === 0">
                <div class="small-circle border me-2 pointer position-relative mes" >
                  <i class="fas fa-user-plus fa-lg"></i>
                </div>
               <div class="my-auto">
                  create new member profile
               </div>
              </div>

            <div class="member-toggle-list " (click)="_authLogout()" >
              <div div class="pointer d-flex p-2">
                <div class="small-circles me-2">
                  <i class="fas fa-sign-out-alt fa-lg"></i>
              </div>
                <div class="text-sm">log out</div>
              </div>
            </div>
          </div>
          <!-- END DROPDOWNBOX -->
        </div>
      </div>
    </div>
  </div>
</div>
